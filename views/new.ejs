<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8" />
  <meta
    name="viewport"
    content="width=device-width, initial-scale=1.0, viewport-fit=cover"
  />
  <title>æ–°å»ºé¡µé¢</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="stylesheet" href="/style.css" />
  <style>
    /* è®©é¢„è§ˆåŒºåœ¨ç§»åŠ¨ç«¯ä¹Ÿå¥½ç”¨ */
    .pane { min-height: 60vh; }
    @media (min-width: 1024px) {
      .pane { min-height: 70vh; }
    }
  </style>
</head>
<body class="min-h-screen bg-gradient-to-br from-gray-50 via-white to-gray-100">
  <div class="mx-auto max-w-7xl px-4 py-10">
    <!-- é¡¶éƒ¨ -->
    <header class="flex items-center justify-between gap-4 mb-8">
      <div class="flex items-center gap-3">
        <img src="/logo.svg" alt="logo" class="h-8 w-8" />
        <h1 class="text-2xl sm:text-3xl font-extrabold tracking-tight text-gray-800">
          æ–°å»ºé¡µé¢
        </h1>
      </div>
      <a href="/" class="btn-ghost">è¿”å›é¦–é¡µ</a>
    </header>

    <form action="/create" method="post" class="space-y-6">
      <!-- åç§° -->
      <div>
        <label class="label">é¡µé¢åç§°ï¼ˆç”¨äºç”Ÿæˆè·¯å¾„ï¼‰</label>
        <input
          name="name"
          placeholder="ä¾‹å¦‚ï¼šæˆ‘çš„ä½œå“é›†"
          class="input"
          required
        />
        <p class="hint">æœ€ç»ˆè®¿é—®è·¯å¾„ç¤ºä¾‹ï¼š<span class="code">/æˆ‘çš„-ä½œå“é›†ï¼ˆä¼šè‡ªåŠ¨è½¬ä¸º slugï¼‰</span></p>
      </div>

      <!-- ç¼–è¾‘ + é¢„è§ˆ -->
      <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
        <div class="pane p-4 rounded-2xl border bg-white/80 shadow-sm">
          <label class="label mb-3">HTML ä»£ç </label>
          <textarea
            id="code"
            name="code"
            class="w-full h-full min-h-[48vh] rounded-xl border p-3 font-mono text-sm focus:outline-none focus:ring-2 focus:ring-blue-500"
            placeholder="åœ¨æ­¤ç²˜è´´æˆ–ç¼–å†™å®Œæ•´ HTMLï¼ˆåŒ…å« <html>... æˆ–ä»…ç‰‡æ®µå‡å¯ï¼‰"
            required
          ><html>
<head>
  <meta charset="UTF-8">
  <title>Hello</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <style>
    body { font-family: system-ui, -apple-system, Segoe UI, Roboto, 'Helvetica Neue', Arial; padding: 24px; }
    .box { padding: 16px; border-radius: 12px; background: #f7f7f8; border: 1px solid #e5e7eb; }
  </style>
</head>
<body>
  <h1>æˆ‘çš„ç¬¬ä¸€ä¸ªé¡µé¢</h1>
  <p class="box">ä½ å¯ä»¥åœ¨å·¦ä¾§ç¼–è¾‘ï¼Œå³ä¾§å®æ—¶é¢„è§ˆã€‚</p>
</body>
</html></textarea>
          <div class="mt-3 flex items-center justify-end gap-3">
            <button type="button" id="btn-format" class="btn-ghost">å°è¯•æ ¼å¼åŒ–</button>
            <button type="button" id="btn-preview" class="btn-primary">æ‰‹åŠ¨åˆ·æ–°é¢„è§ˆ</button>
          </div>
        </div>

        <div class="pane p-4 rounded-2xl border bg-white/80 shadow-sm">
          <div class="flex items-center justify-between mb-3">
            <label class="label">å®æ—¶é¢„è§ˆ</label>
            <span id="status" class="text-xs text-gray-500">è‡ªåŠ¨é¢„è§ˆï¼ˆé˜²æŠ– 400msï¼‰</span>
          </div>
          <iframe id="preview" class="w-full h-full min-h-[48vh] rounded-xl border"></iframe>
        </div>
      </div>

      <!-- æäº¤ -->
      <div class="flex items-center justify-end gap-3">
        <button class="btn-primary">ğŸš€ å‘å¸ƒ</button>
      </div>
    </form>
  </div>

  <script>
    const ta = document.getElementById('code');
    const frame = document.getElementById('preview');
    const statusEl = document.getElementById('status');
    const btnPreview = document.getElementById('btn-preview');
    const btnFormat = document.getElementById('btn-format');

    let t = null;

    function setPreview(html) {
      // ä½¿ç”¨ srcdoc ç›´æ¥é¢„è§ˆ
      frame.srcdoc = html;
    }

    function scheduleUpdate() {
      clearTimeout(t);
      statusEl.textContent = 'é¢„è§ˆæ›´æ–°ä¸­â€¦';
      t = setTimeout(() => {
        setPreview(ta.value);
        statusEl.textContent = 'è‡ªåŠ¨é¢„è§ˆï¼ˆé˜²æŠ– 400msï¼‰';
      }, 400);
    }

    ta.addEventListener('input', scheduleUpdate);
    btnPreview.addEventListener('click', () => setPreview(ta.value));

    // ç®€æ˜“æ ¼å¼åŒ–ï¼ˆä»…ç¼©è¿›ä¸æ¢è¡Œçš„è½»é‡å¤„ç†ï¼Œé¿å…å¼•å…¥å¤–éƒ¨åº“ï¼‰
    btnFormat.addEventListener('click', () => {
      try {
        // éä¸¥æ ¼æ ¼å¼åŒ–ï¼šé€šè¿‡ DOMParser è§„èŒƒåŒ–æ ‡ç­¾ï¼ˆå¯èƒ½æ”¹å˜åŸæ ·å¼ï¼Œè¯·é…Œæƒ…ä½¿ç”¨ï¼‰
        const parser = new DOMParser();
        const doc = parser.parseFromString(ta.value, 'text/html');
        // é‡æ–°åºåˆ—åŒ–
        const doctype = '<!DOCTYPE html>';
        const html = doc.documentElement.outerHTML;
        ta.value = (html.startsWith('<!DOCTYPE') ? html : (doctype + '\n' + html));
        scheduleUpdate();
      } catch (e) {
        alert('æ ¼å¼åŒ–å¤±è´¥ï¼š' + e.message);
      }
    });

    // åˆå§‹æ¸²æŸ“
    setPreview(ta.value);
  </script>
</body>
</html>
